<app-page>
    <app-task-detail-header
        [headingLoading]="isLoading"
        [icon]="'organization_definition_key'"
        [pageSubTitle]="dependencies?.organization?.name"
        [pageTitle]=headerLibelle
        [status]="dependencies?.organization?.functional_status"
    ></app-task-detail-header>
    <div *ngIf="!isLoading">
        <app-tabs>
            <app-tab [icon]="'key_icon_circle'" [label]="'personalSpace.organizationDetails.demande' | translate">
                <ng-template>
                    <div class="organization-details-container">
                        <div class="organization-information-container">

                            <ng-container *ngIf="hasSections">
                                <ng-container *ngFor="let section of currentTask?.asset?.form?.sections">
                                    <app-workflow-expansion [section]="section" [title]="headerLibelle"></app-workflow-expansion>
                                </ng-container>
                            </ng-container>

                            <mat-accordion>
                                <mat-expansion-panel [expanded]="!hasSections" class="organization-modified-expansion" (opened)="panelInitialTaskOpenState.set(true)" (closed)="panelInitialTaskOpenState.set(false)">
                                <mat-expansion-panel-header>
                                    <mat-panel-title class="expansion-title">
                                        {{ 'personalSpace.organizationDetails.organizationInformations' | translate }}
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                    <hr>
                                    <app-organization-information
                                        [organization]="dependencies?.organization"></app-organization-information>
                                </mat-expansion-panel>
                            </mat-accordion>


                        </div>
                        <div class="owner-information-container" *ngIf="ownerInfo | async as ownerInformation">
                            <app-owner-information [email]="ownerInformation?.contact"
                                                   [name]="ownerInformation?.name"
                                                   [title]="'personalSpace.organizationDetails.supplier' | translate"
                            ></app-owner-information>
                        </div>
                    </div>
                </ng-template>
            </app-tab>

            <app-banner-button (click)="openPopinForAction(action, false)"
                               *ngFor="let action of actions">
                {{ action.label }}
            </app-banner-button>

        </app-tabs>
    </div>
</app-page>
